<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="logo.jpg">
<title>AO Dashboard - Asset Inventory</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        primary: '#011f51',
        dark: '#010e25',
        accent: '#2e7eff',
        soft: '#a3b5e4',
        expired: '#ff4c4c',
        warning: '#ffb74d',
        valid: '#4cd964',
      },
      fontFamily: { poppins: ['Poppins', 'sans-serif'] },
    },
  },
};
</script>

<style>

body {
  background: radial-gradient(circle at top left, #010e25, #011f51);
  font-family: 'Poppins', sans-serif;
  color: #e8ecff;
}

.glass-card {
  background: rgba(0,0,0,0.5);
  border-radius: 16px;
  backdrop-filter: blur(12px);
  box-shadow: 0 5px 25px rgba(0,0,0,0.6);
  padding: 1.2rem;
}

.btn {
  background: linear-gradient(90deg,#011f51,#2e7eff);
  color:#fff;
  font-weight:600;
  border-radius:10px;
  padding:10px;
  transition:0.2s;
  width:100%;
}

.btn:hover {
  background: linear-gradient(90deg,#2e7eff,#011f51);
}

.logout-btn {
  background: rgba(255,70,70,0.3);
}

.summary-card {
  text-align:center;
  padding:10px;
  border-radius:10px;
}

.summary-card p {
  font-size:18px;
  font-weight:bold;
}


/* MODULE TABS (Assets Energy Inventory) */

.module-tab {
  padding:8px;
  border-radius:8px;
  font-size:14px;
  color:#a3b5e4;
  background:transparent;
  width:100%;
}

.module-tab.active {
  background: linear-gradient(90deg,#011f51,#2e7eff);
  color:white;
}

.module-panel {
  margin-top:12px;
}

.hidden {
  display:none;
}

</style>


<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";


const firebaseConfig = {
  apiKey: "AIzaSyCtdmsd0gWLPqwNpRI2lpiif_FuG-PTHjQ",
  authDomain: "ao-asset.firebaseapp.com",
  projectId: "ao-asset",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);


if(!sessionStorage.getItem('user')){
  window.location.href='index.html';
}

window.logout = function(){
  sessionStorage.removeItem('user');
  window.location.href='index.html';
};


/* MODULE TAB SWITCHING */

window.showModule = function(name){

  document.querySelectorAll(".module-panel")
    .forEach(el => el.classList.add("hidden"));

  document.getElementById("module-"+name)
    .classList.remove("hidden");

  document.querySelectorAll(".module-tab")
    .forEach(el => el.classList.remove("active"));

  document.getElementById("tab-"+name)
    .classList.add("active");
};



/* LOAD DASHBOARD */

async function loadDashboard(){

  const snapshot = await getDocs(collection(db,"assets"));
  const assets = snapshot.docs.map(doc => doc.data());

  const total = assets.length;

  const expired = assets.filter(a =>
    new Date(a.amcEnd) < new Date()
  ).length;

  const expiring = assets.filter(a=>{
    const d=new Date(a.amcEnd);
    const today=new Date();
    return d>=today && d<=new Date(today.getTime()+30*24*60*60*1000);
  }).length;

  const valid = total-expired-expiring;

  document.getElementById("total-assets").textContent=total;
  document.getElementById("amc-expired").textContent=expired;
  document.getElementById("amc-warning").textContent=expiring;
  document.getElementById("amc-valid").textContent=valid;



  /* BLOCK CHART */

  const blockCount={};

  assets.forEach(a=>{
    if(!a.location)return;
    const block=a.location.split(",")[0].trim();
    blockCount[block]=(blockCount[block]||0)+1;
  });

  const labels=Object.keys(blockCount);
  const data=labels.map(l=>blockCount[l]);

  if(labels.length>0){

    new Chart(document.getElementById("blockChart"),{

      type:"bar",

      data:{
        labels:labels,
        datasets:[{
          label:"Assets",
          data:data,
          backgroundColor:"#2e7eff"
        }]
      },

      options:{
        plugins:{legend:{labels:{color:"#e8ecff"}}},
        scales:{
          x:{ticks:{color:"#e8ecff"}},
          y:{ticks:{color:"#e8ecff"}}
        }
      }

    });

  }

}

window.addEventListener("DOMContentLoaded",loadDashboard);

</script>

</head>



<body class="min-h-screen flex flex-col items-center gap-4 p-4">



<!-- HEADER -->

<div class="glass-card w-full max-w-6xl flex justify-between items-center">

  <div class="flex items-center gap-3">
    <img src="logo.jpg" class="w-8">

    <div>
      <div class="text-accent font-semibold">
        AO Asset Dashboard
      </div>

      <div class="text-soft text-xs">
        Asset Management System
      </div>
    </div>
  </div>

  <button onclick="logout()" class="btn logout-btn w-auto px-3">
    Logout
  </button>

</div>




<!-- MODULE TABS SECTION (REPLACED PARTITIONS) -->

<div class="glass-card w-full max-w-4xl">

  <div class="grid grid-cols-3 gap-2">

    <button id="tab-assets"
            class="module-tab active"
            onclick="showModule('assets')">
      Assets
    </button>

    <button id="tab-energy"
            class="module-tab"
            onclick="showModule('energy')">
      Energy
    </button>

    <button id="tab-inventory"
            class="module-tab"
            onclick="showModule('inventory')">
      Inventory
    </button>

  </div>



  <!-- ASSETS PANEL -->

  <div id="module-assets" class="module-panel">

    <div class="flex flex-col gap-2">

      <button onclick="location.href='register.html'" class="btn">
        Register Asset
      </button>

      <button onclick="location.href='filterasset.html'" class="btn">
        View Assets
      </button>

      <button onclick="location.href='scan.html'" class="btn">
        Asset Scanner
      </button>

    </div>

  </div>



  <!-- ENERGY PANEL -->

  <div id="module-energy" class="module-panel hidden">

    <div class="flex flex-col gap-2">

      <button onclick="location.href='energyconsumption.html'" class="btn">
        Register Energy Consumption
      </button>

      <button onclick="location.href='filterenergyconsumption.html'" class="btn">
        View Energy Consumption
      </button>

    </div>

  </div>



  <!-- INVENTORY PANEL -->

  <div id="module-inventory" class="module-panel hidden">

    <div class="flex flex-col gap-2">

      <button onclick="location.href='updateinventory.html'" class="btn">
        Update Inventory
      </button>

      <button onclick="location.href='filterinventory.html'" class="btn">
        View Inventory
      </button>

    </div>

  </div>

</div>




<!-- SUMMARY CARDS (UNCHANGED) -->

<div class="glass-card w-full max-w-4xl grid grid-cols-2 sm:grid-cols-4 gap-3">

  <div class="summary-card bg-accent/30">
    <div>Total Assets</div>
    <p id="total-assets">0</p>
  </div>

  <div class="summary-card bg-expired/30">
    <div>AMC Expired</div>
    <p id="amc-expired">0</p>
  </div>

  <div class="summary-card bg-warning/30">
    <div>AMC Expiring</div>
    <p id="amc-warning">0</p>
  </div>

  <div class="summary-card bg-valid/30">
    <div>AMC Valid</div>
    <p id="amc-valid">0</p>
  </div>

</div>




<!-- BLOCK CHART (UNCHANGED) -->

<div class="glass-card w-full max-w-4xl">

  <div class="text-accent font-semibold mb-2">
    Block-wise Asset Overview
  </div>

  <canvas id="blockChart"></canvas>

</div>




<!-- FOOTER -->

<div class="text-xs text-soft text-center mt-2">

Â© 2025 AO Asset And Facility Management System

</div>



</body>
</html>